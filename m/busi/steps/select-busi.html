<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>入网业务</title>
    <link rel="stylesheet" href="../../js/lib/weuijs/style/weuijs.min.css">
    <link rel="stylesheet" href="../../css/ui-base.css">
</head>

<body>
    <div id="page1" class="page page_show">
        <div class="weui-search-bar hide">
            <a href="javascript:" class="search-bar__btn" onclick="back()">返回</a>
            <form class="weui-search-bar__form" method="post" action="">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" name="search" placeholder="" readonly>
                    <a href="javascript:" class="weui-icon-clear"></a>
                </div>
                <label class="weui-search-bar__label">
                    <!--i class="weui-icon-search"></i-->
                    <h1>选择接入机构</h1> </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn hide">取消</a>
        </div>
        <div class="weui-cells__title">选择接入机构</div>
        <div class="weui-cells searchbar-result">
            <!-- <div class="weui-cell weui-cell_access">
                <div class="weui-cell__bd weui-cell_primary">
                    <p>实时搜索文本</p>
                </div>
            </div> -->
        </div>
    </div>
    
    <div id="page2" class="page">
        <div class="weui-search-bar hide">
            <a href="javascript:" class="search-bar__btn" onclick="weui.page.back()">返回</a>
            <form class="weui-search-bar__form" method="post" action="">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" name="search" placeholder="" readonly>
                    <a href="javascript:" class="weui-icon-clear"></a>
                </div>
                <label class="weui-search-bar__label">
                    <!--i class="weui-icon-search"></i-->
                    <h1>选择机构业务类型</h1> </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn hide">取消</a>
        </div>
        <div class="weui-cells__title">选择机构业务类型</div>
        <div class="weui-cells searchbar-result">
            <!-- <div class="weui-cell weui-cell_access">
                <div class="weui-cell__bd weui-cell_primary">
                    <p>实时搜索文本</p>
                </div>
            </div> -->
        </div>
    </div>
    
    <div id="page3" class="page">
        <div class="weui-search-bar hide">
            <a href="javascript:" class="search-bar__btn" onclick="weui.page.back()">返回</a>
            <form class="weui-search-bar__form" method="post" action="">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" name="search" placeholder="" readonly>
                    <a href="javascript:" class="weui-icon-clear"></a>
                </div>
                <!--label class="weui-search-bar__label">
                    <h1>商户类型</h1> </label-->
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn hide" style="background-color:cadetblue">取消</a>
        </div>
        <div class="weui-cells searchbar-result">
            <!-- <div class="weui-cell weui-cell_access">
                <div class="weui-cell__bd weui-cell_primary">
                    <p>实时搜索文本</p>
                </div>
            </div> -->
        </div>
    </div>
    
    <!-- <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=mUs8UNiHRImGLNueae1Gd9PVdejrYdHC"></script> -->
    <script type="text/javascript" src="../../js/lib/zepto.min.js"></script>
    <script type="text/javascript" src="../../js/lib/weuijs/weuijs.min.js"></script>
    <script id="list-template" type="text/html">
        {{each rows as row i}}
        <div class="weui-cell weui-cell_access searchbar-result__item" data-index="{{total+i}}" style="border-radius: 4px; margin-bottom: 8px; background-color:cadetblue; height:50px;">
            <div class="weui-cell__bd weui-cell_primary">
                <h2 align="center" style="font-family: "Georgia", Tahoma, Sans-Serif;font-size: 12px;line-height: 18px;color: #888;">{{row.busi_type_nm}}</h2>
            </div>
            <div class="weui-cell__ft"></div>
        </div>
        {{/each}}
    </script>
    <script id="acq-template" type="text/html">
        {{each rows as row i}}
        <div class="weui-cell weui-cell_access searchbar-result__item" data-index="{{total+i}}" style="border-radius: 4px; margin-bottom: 8px; background-color:cadetblue; height:50px;">
            <div class="weui-cell__bd weui-cell_primary">
                <h2 align="center" style="font-family: "Georgia", Tahoma, Sans-Serif;font-size: 12px;line-height: 18px;color: #888;">{{row.acq_inst_nm}}</p>
            </div>
            <div class="weui-cell__ft"></div>
        </div>
        {{/each}}
    </script>
    <script id="mt-template" type="text/html">
        {{each rows as row i}}
        <div class="weui-cell weui-cell_access searchbar-result__item" data-index="{{total+i}}" style="border-radius: 4px; margin-bottom: 8px; background-color:cadetblue; height:50px;">
            <div class="weui-cell__bd weui-cell_primary">
                <h2 align="center" style="font-family: "Georgia", Tahoma, Sans-Serif;font-size: 12px;line-height: 18px;color: #888;">{{row.text}}</h2>
            </div>
            <div class="weui-cell__ft"></div>
        </div>
        {{/each}}
    </script>
    <script>
    var query = $$.parseQueryString();
	
	function back() {
		window.location.href = '../../index.html';
	}
	
	history.pushState(null, null, document.URL);
	window.addEventListener('popstate', function () {
		weui.page.back();
	});
		
	weui.searchPage('#page1', {
		resultTpl: '#acq-template',
		loader: function(param, success, error) {
			$$.request('/action/bm/acq-inst/search', {}, {
				success: function(data) {
					if (data.errcode == 0) {
						success(data.rows);
					} else {
						weui.alert(data.errmsg, {
							title: '提示'
						});
					}
				},
				error: error()
			})
		},
		onClickItem: function(row) {
			weui.page.show('#page2');
			var acq_inst = row.acq_inst_id;
			weui.searchPage('#page2', {
				resultTpl: '#list-template',
				
				loader: function(param, success, error) {
					console.log(arguments);
					$$.request('/action/bm/acq-inst-busi/list', {
						acq_inst_id: acq_inst
					}, {
						success: function(data) {
							if (data.errcode == 0) {
								success(data.rows);
							} else {
								weui.alert(data.errmsg, {
									title: '提示'
								});
							}
						},
						error: error
					});
				},
				onInput: function() {
					console.log(arguments);
				},
				onClickItem: function(row) {
					weui.page.show('#page3');
					var busi_type = row.busi_type;
					weui.searchPage('#page3', {
						resultTpl: '#mt-template',

						loader: function(param, success, error) {
							console.log(arguments);
							$$.request('/action/bm/mchnt-type/list', {}, {
								success: function(data) {
									if (data.errcode == 0) {
										success(data.rows);
									} else {
										weui.alert(data.errmsg, {
											title: '提示'
										});
									}
								},
								error: error
							});
						},
						onInput: function() {
							console.log(arguments);
						},
						onClickItem: function(row) {
							var param = {busi_type: busi_type,
										 acq_inst_id: acq_inst,
										 mchnt_type: row.value};
							$.extend({}, query, param);
							window.location.href = "./photos.html?" + $.param(param);
						}
					}).search()
				}
			}).search()
        }
    }).search();
    
    </script>
</body>

</html>
