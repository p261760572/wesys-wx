<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>e通</title>
    <link rel="stylesheet" href="../js/lib/weuijs/style/weuijs.css">
    <link rel="stylesheet" href="../css/ui-base.css">
    <style type="text/css">
    .show-more {
        display: none;
    }
    
    .page_more .show-more {
        display: block;
    }
    
    .page_more .hide-more {
        display: none;
    }
    
    .page_view .hide-view {
        display: none;
    }
    </style>
</head>

<body>
   	<div id="page1" class="page page_show">
        <div class="weui-search-bar">
            <a id="add-btn" href="javascript:" class="search-bar__btn">新增</a>
            <form class="weui-search-bar__form" method="post" action="">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" name="search" placeholder="搜索">
                    <a href="javascript:" class="weui-icon-clear"></a>
                </div>
                <label class="weui-search-bar__label">
                    <i class="weui-icon-search"></i>
                    <span>搜索</span> </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn">取消</a>
        </div>
        <div class="weui-cells searchbar-result"></div>
    </div>
    <div id="page2" class="page">
        <form id="form">
            <div class="weui-cells__title">商户基本信息</div>
            <div class="weui-cells weui-cells_form">
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">联系人<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                                <input name="linkman" type="text" class="weui-input validate" placeholder="请输入联系人" required title="联系人">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">联系人手机<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="mobile" type="text" class="weui-input validate" placeholder="请输入联系人手机" required title="联系人手机">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">联系电话</label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="tel_no" type="text" class="weui-input" placeholder="请输入联系电话">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">营业执照号码<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input id="license_no" name="license_no" type="text" class="weui-input validate" placeholder="请输入营业执照号码" required title="营业执照号码" style="text-transform:uppercase;">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">户名<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input id="account_name" name="account_name" type="text" class="weui-input validate" placeholder="请输入户名" required title="户名">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">账号<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input id="account_no" name="account_no" type="text" class="weui-input validate" placeholder="请输入账号" required title="账号">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">开户支行名称<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input id="subbranch_name" name="subbranch_name" type="text" class="weui-input validate" placeholder="请选择开户支行名称" required title="开户支行名称" readonly>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">借记卡手续费<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="fee_algo" type="text" class="weui-input validate" placeholder="请选择借记卡手续费" id="fee_algo" required title="借记卡手续费" readonly>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">贷记卡手续费<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="credit_fee_algo" type="text" class="weui-input validate" placeholder="请选择贷记卡手续费" id="credit_fee_algo" required title="贷记卡手续费" readonly>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">装机地区<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input id="district" name="district_name" type="text" class="weui-input validate" placeholder="请选择装机地区" required title="装机地区" readonly>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">装机详细地址<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="installed_addr" type="text" id="installed_addr" class="weui-input validate" placeholder="请输入详细地址(需核对)" required title="装机详细地址">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label for="" class="weui-label">机具类型<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <!-- <select id="equi_type" class="weui-select validate" name="equi_type" required="required" title="机具类型">
                            </select> -->
                            <input name="equi_type" type="text" class="weui-input validate" placeholder="请选择机具类型" id="equi_type" required>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">装机数量<span class="required">*</span></label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="num_term" type="number" class="weui-input validate" placeholder="请输入装机数量" value="1" required title="装机数量">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">押金</label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="deposit_amount" type="number" class="weui-input" placeholder="请输入押金">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">通讯费</label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="traffic_amount" type="number" class="weui-input" placeholder="请输入通讯费">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">销售款</label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="sale_amount" type="number" class="weui-input" placeholder="请输入销售款">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">备注</label>
                        </div>
                        <div class="weui-cell__bd">
                            <input name="remark" type="text" class="weui-input" placeholder="请输入备注">
                        </div>
                    </div>
                </div>
                <div class="weui-cells weui-cells_form" >
                    <div class="weui-cells__title">上传照片</div>
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    营业执照照片<span class="required">*</span>
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="01">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    法人身份证照片
                                    <span class="required">*</span>
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="03">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    结算账户(银行卡)照片
                                    <span class="required">*</span>
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="16">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell show-more">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd ">
                                    税务登记证照片
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="02">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell show-more">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    商户协议(v1)
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="06">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell show-more">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    门店照片
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="04">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell show-more">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    账号授权书
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="13">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cell show-more">
                        <div class="weui-cell__bd">
                            <div class="weui-uploader">
                                <div class="weui-uploader__hd">
                                    其他照片
                                </div>
                                <div class="weui-uploader__bd">
                                    <ul class="weui-uploader__files" id="17">
                                    </ul>
                                    <div class="weui-uploader__input-box">
                                        <input class="weui-uploader__input" type="file" accept="image/*" capture="camera" value="照片">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="javascript:;" class="weui-cell weui-cell_link" onclick="showMore()">
                    <div class="weui-cell__bd" style="text-align: center;"><span class="hide-more">更多</span><span class="show-more">隐藏</span></div>
                </a>
                <input type="button" class="weui-btn weui-btn_primary hide-view" value="提交" onclick="submitDetail()">
            </form>
        </div>
    <script type="text/javascript" src="../js/lib/zepto.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/lib/weuijs/weuijs.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/api?ak=kKuGiC4LbGgwrcfd1pQKq7M5Ax2GAnCy&v=2.0&s=1"></script>
    <script id="result-template" type="text/html">
        {{each rows as row}}
        <div class="weui-cell weui-cell_access searchbar-result__item">
            <div class="weui-cell__bd weui-cell_primary">
                <p>
                    {{row.text}}
                </p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </div>
        {{/each}}
    </script>
    
    <script>
		var district = [{ "text": "湖南省", "children": [{ "text": "长沙市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "芙蓉区", "value": "02" }, { "text": "天心区", "value": "03" }, { "text": "岳麓区", "value": "04" }, { "text": "开福区", "value": "05" }, { "text": "雨花区", "value": "11" }, { "text": "望城区", "value": "12" }, { "text": "长沙县", "value": "21" }, { "text": "宁乡县", "value": "24" }, { "text": "浏阳市", "value": "81" }], "value": "01" }, { "text": "株洲市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "荷塘区", "value": "02" }, { "text": "芦淞区", "value": "03" }, { "text": "石峰区", "value": "04" }, { "text": "天元区", "value": "11" }, { "text": "株洲县", "value": "21" }, { "text": "攸县", "value": "23" }, { "text": "茶陵县", "value": "24" }, { "text": "炎陵县", "value": "25" }, { "text": "醴陵市", "value": "81" }], "value": "02" }, { "text": "湘潭市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "雨湖区", "value": "02" }, { "text": "岳塘区", "value": "04" }, { "text": "湘潭县", "value": "21" }, { "text": "湘乡市", "value": "81" }, { "text": "韶山市", "value": "82" }], "value": "03" }, { "text": "衡阳市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "珠晖区", "value": "05" }, { "text": "雁峰区", "value": "06" }, { "text": "石鼓区", "value": "07" }, { "text": "蒸湘区", "value": "08" }, { "text": "南岳区", "value": "12" }, { "text": "衡阳县", "value": "21" }, { "text": "衡南县", "value": "22" }, { "text": "衡山县", "value": "23" }, { "text": "衡东县", "value": "24" }, { "text": "祁东县", "value": "26" }, { "text": "耒阳市", "value": "81" }, { "text": "常宁市", "value": "82" }], "value": "04" }, { "text": "邵阳市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "双清区", "value": "02" }, { "text": "大祥区", "value": "03" }, { "text": "北塔区", "value": "11" }, { "text": "邵东县", "value": "21" }, { "text": "新邵县", "value": "22" }, { "text": "邵阳县", "value": "23" }, { "text": "隆回县", "value": "24" }, { "text": "洞口县", "value": "25" }, { "text": "绥宁县", "value": "27" }, { "text": "新宁县", "value": "28" }, { "text": "城步苗族自治县", "value": "29" }, { "text": "武冈市", "value": "81" }], "value": "05" }, { "text": "岳阳市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "岳阳楼区", "value": "02" }, { "text": "云溪区", "value": "03" }, { "text": "君山区", "value": "11" }, { "text": "岳阳县", "value": "21" }, { "text": "华容县", "value": "23" }, { "text": "湘阴县", "value": "24" }, { "text": "平江县", "value": "26" }, { "text": "汨罗市", "value": "81" }, { "text": "临湘市", "value": "82" }], "value": "06" }, { "text": "常德市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "武陵区", "value": "02" }, { "text": "鼎城区", "value": "03" }, { "text": "安乡县", "value": "21" }, { "text": "汉寿县", "value": "22" }, { "text": "澧县", "value": "23" }, { "text": "临澧县", "value": "24" }, { "text": "桃源县", "value": "25" }, { "text": "石门县", "value": "26" }, { "text": "津市市", "value": "81" }], "value": "07" }, { "text": "张家界市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "永定区", "value": "02" }, { "text": "武陵源区", "value": "11" }, { "text": "慈利县", "value": "21" }, { "text": "桑植县", "value": "22" }], "value": "08" }, { "text": "益阳市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "资阳区", "value": "02" }, { "text": "赫山区", "value": "03" }, { "text": "南县", "value": "21" }, { "text": "桃江县", "value": "22" }, { "text": "安化县", "value": "23" }, { "text": "沅江市", "value": "81" }], "value": "09" }, { "text": "郴州市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "北湖区", "value": "02" }, { "text": "苏仙区", "value": "03" }, { "text": "桂阳县", "value": "21" }, { "text": "宜章县", "value": "22" }, { "text": "永兴县", "value": "23" }, { "text": "嘉禾县", "value": "24" }, { "text": "临武县", "value": "25" }, { "text": "汝城县", "value": "26" }, { "text": "桂东县", "value": "27" }, { "text": "安仁县", "value": "28" }, { "text": "资兴市", "value": "81" }], "value": "10" }, { "text": "永州市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "零陵区", "value": "02" }, { "text": "冷水滩区", "value": "03" }, { "text": "祁阳县", "value": "21" }, { "text": "东安县", "value": "22" }, { "text": "双牌县", "value": "23" }, { "text": "道县", "value": "24" }, { "text": "江永县", "value": "25" }, { "text": "宁远县", "value": "26" }, { "text": "蓝山县", "value": "27" }, { "text": "新田县", "value": "28" }, { "text": "江华瑶族自治县", "value": "29" }], "value": "11" }, { "text": "怀化市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "鹤城区", "value": "02" }, { "text": "中方县", "value": "21" }, { "text": "沅陵县", "value": "22" }, { "text": "辰溪县", "value": "23" }, { "text": "溆浦县", "value": "24" }, { "text": "会同县", "value": "25" }, { "text": "麻阳苗族自治县", "value": "26" }, { "text": "新晃侗族自治县", "value": "27" }, { "text": "芷江侗族自治县", "value": "28" }, { "text": "靖州苗族侗族自治县", "value": "29" }, { "text": "通道侗族自治县", "value": "30" }, { "text": "洪江市", "value": "81" }], "value": "12" }, { "text": "娄底市", "children": [{ "text": "市辖区", "value": "01" }, { "text": "娄星区", "value": "02" }, { "text": "双峰县", "value": "21" }, { "text": "新化县", "value": "22" }, { "text": "冷水江市", "value": "81" }, { "text": "涟源市", "value": "82" }], "value": "13" }, { "text": "湘西土家族苗族自治州", "children": [{ "text": "吉首市", "value": "01" }, { "text": "泸溪县", "value": "22" }, { "text": "凤凰县", "value": "23" }, { "text": "花垣县", "value": "24" }, { "text": "保靖县", "value": "25" }, { "text": "古丈县", "value": "26" }, { "text": "永顺县", "value": "27" }, { "text": "龙山县", "value": "30" }], "value": "31" }], "value": "43" }];

		var operateType;
		var searchPage = weui.searchPage('#page1', {
			resultTpl: '#result-template',
			loader: onSearch,
			onChange: function() {
				console.log(this, arguments);
			},
			onSelect: function(row) {
				console.log(this, arguments);
				// weui.page.back();
				showActions(row);
			}
		});

		function onSearch(param, success, error) {
			$$.request('/action/bm/mchnt-base-info/search', param, {
				success: function(data) {
					if (data.errcode == 0) {
						success(data.rows);
					} else {
						weui.alert(data.errmsg, function () {
							error();
						}, { title: '提示' });
					}
				},
				error: function() {
					error();
				}
			});
		}
		
		function onView(param) {
			$$.request('/action/bm/mchnt-base-info/view', param, {
				success: function(data) {
					if (data.errcode == 0) {
						loadDetailForm(data.data);
					} else {
						weui.alert(data.errmsg, { title: '提示' });
					}
				},
				error: function() {}
			});
		}

		function onDelete(param) {
			$$.request('/action/bm/mchnt-base-info/delete', param, {
				success: function(data) {
					if (data.errcode == 0) {
						weui.toast('操作成功');
					} else {
						weui.alert(data.errmsg, { title: '提示' });
					}
				},
				error: function() {}
			});
		}

		function showActions(row) {
			weui.actionSheet([{
				label: '查看',
				onClick: function() {
					console.log(this, arguments);
					onView(row);
					weui.page.show('#page2');
					$('#back-btn').show().siblings().hide();
				}
			}, {
				label: '新增',
				onClick: function() {
					console.log(this, arguments);
					onView(row);
					operateType = 'create';
					weui.page.show('#page2');
					$('#back-btn').show().siblings().show();
				}
			}, {
				label: '编辑',
				onClick: function() {
					console.log(this, arguments);
					onView(row);
					operateType = 'update';
					weui.page.show('#page2');
					$('#back-btn').show().siblings().show();
				}
			}, {
				label: '删除',
				onClick: function() {
					console.log(this, arguments);
					weui.confirm('确认要删除?', function() {
						onDelete(row);
					});
				}
			}], [{
				label: '取消',
				onClick: function() {
					console.log(this, arguments);
				}
			}]);
		}
		
		function onSubmit() {
			if (!weui.form.validate('#form', options)) return;
			var param = serializeDetailForm();

			$$.request('/action/bm/mchnt-base-info/' + operateType, param, {
				success: function(data) {
					if (data.errcode == 0) {
						weui.toast('操作成功');
					} else {
						weui.alert(data.errmsg, { title: '提示' });
					}
				},
				error: function() {}
			});
		}

		function onClickAdd() {
			operateType = 'create';
			weui.page.show('#page2');
		}
		
		function showMore() {
			var page = $('#page2');
			if (page.hasClass('page_more')) {
				page.removeClass('page_more');
			} else {
				page.addClass('page_more');
			}
		}
		
		function serializeDetailForm() {
			var data = $('#form').serializeObject();
			data.apptype = '105';
			data.license_no = data.license_no.toUpperCase();

			//照片处理
			var images = [];
			$('#form').find('.weui-uploader__files').each(function(i, element) {
				var type = $(element).attr('id');
				var container = $(element).children('input[type="file"]').each(function(i, element) {
					var fileData = $(element).data('file');
					images.push($.extend(fileData, {
						'ei_type': type
					}));
				});
			});

			data.images = images;

			return data;
		}


		function loadDetailForm(data) {
			//图片
			$('#form').find('.weui-uploader__files').each(function(i, element) {
				$(element).html('');
			});

			var images = data.images;
			var itemTpl = '<li class="weui-uploader__file weui-uploader__file_status" data-id="{{id}}"><div class="weui-uploader__file-content"><i class="weui-loading" style="width: 30px;height: 30px;"></i></div></li>';
			$.each(images, function(index, item) {
				var file = $($.render(itemTpl, {
					id: index
				}));
				$('#' + item.ei_type).append(file).data('file', item);
				file.css({
					backgroundImage: 'url("' + item.file_url + '")'
				});
			});

			$('#form').form('load', data.data);
		}

		$(function(){
			$('#add-btn').on('click', onClickAdd);
        	$('#submit-btn').on('click', onSubmit) ;
			$('#district').on('click', function() {
				weui.picker(district,
								{
									valueField: 'value',
									textField: 'text',
									className: 'custom-classname',
									onChange: function(result) {
										console.log(result)
									},
									onConfirm: function(result) {
										console.log(result);
										//$(this).html(result[0].text+result[1].text+result[2].text);
									},
									id: 'DistrictPicker'
								})
			});
			$$.request('/action/ms/parameter/list', {
				debit_fee_algo: '1',
				credit_fee_algo: '1',
				equi_type: '1',
				account_bank: '1'
			}, function(data) {
				if (data.errcode == 0) {
					$('#equi_type').on('click', function() {
						weui.picker(data.equi_type,
										{
											valueField: 'value',
											textField: 'text',
											className: 'custom-classname',
											onChange: function(result) {
												console.log(result)
											},
											onConfirm: function(result) {
												console.log(result)
											},
											id: 'EquiPicker'
										})
					});
					
					$('#fee_algo').on('click', function() {
						weui.picker(data.debit_fee_algo,
										{
											valueField: 'value',
											textField: 'text',
											className: 'custom-classname',
											onChange: function(result) {
												console.log(result)
											},
											onConfirm: function(result) {
												console.log(result)
											},
											id: 'FeePicker'
										})
					});
					
					$('#credit_fee_algo').on('click', function() {
						weui.picker(data.credit_fee_algo,
										{
											valueField: 'value',
											textField: 'text',
											className: 'custom-classname',
											onChange: function(result) {
												console.log(result)
											},
											onConfirm: function(result) {
												console.log(result)
											},
											id: 'CreditPicker'
										})
					});
				}
			});
			
			$('#subbranch_name').on('click', function() {
				var select2 = weui.select2({
					data: [],
					loader: function(param, success, error) {
						 $.ajax({
						     url: 'url',
						     type: 'POST',
						     dataType: 'json',
						     data: param,
						     success: function(data) {
						         success(data.rows);
						     },
						     error: function(error) {
						         error();
						     }
						 });
					},
					onClickItem: function(row) {
						console.log(arguments);
						$('#subbranch_name').val(row.text);
					}
				});
    		});
			
			$('.weui-uploader').each(function(i, element) {
				var uploadCount = 0;
				var uploader = weui.ajaxUploader(this, {
					url: '/m/action/upload',
					auto: true,
					type: 'file',
					fileVal: 'file',
					compress: {
						width: 1600,
						height: 1600,
						quality: 0.92
					},
					onBeforeSend: function(data, headers, files) {
						console.log(this, arguments);
						// $.extend(data, { test: 1 }); // 可以扩展此对象来控制上传参数
						// $.extend(headers, { Origin: 'http://127.0.0.1' }); // 可以扩展此对象来控制上传头部
						if(["image/jpg", "image/jpeg", "image/png", "image/gif"].indexOf(this.type) < 0){
							weui.alert('请上传图片');
							return false; // 阻止文件添加
						}
						if(this.size > 10 * 1024 * 1024){
							weui.alert('请上传不超过10M的图片');
							return false;
						}
						if (files.length > 1) { // 防止一下子选择过多文件
							weui.alert('最多同时传1张图片，请重新选择');
							return false;
						}
						// return false; // 阻止文件上传
					},
					onProgress: function(procent) {
						console.log(this, arguments);
						// return true; // 阻止默认行为，不使用默认的进度显示
					},
					onSuccess: function(ret) {
						console.log(this, arguments);
						// return true; // 阻止默认行为，不使用默认的成功态
					},
					onError: function(err) {
						console.log(this, arguments);
						// return true; // 阻止默认行为，不使用默认的失败态
					}
				});
			});
		})
	</script>
</body>

</html>
