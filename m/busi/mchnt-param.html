<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>商户参数</title>
    <link rel="stylesheet" href="../js/lib/weuijs/style/weuijs.css">
    <style type="text/css">
    .weui-cells {
        /*font-size: 16px;*/
    }
    
    .weui-cell__bd {
        position: relative;
    }
    </style>
</head>

<body>
    <div id="page1" class="page page_show">
        <div class="weui-search-bar">
            <a id="add-btn" href="javascript:" class="search-bar__btn">新增</a>
            <form class="weui-search-bar__form" method="post" action="">
                <div class="weui-search-bar__box">
                    <i class="weui-icon-search"></i>
                    <input type="search" class="weui-search-bar__input" name="search" placeholder="搜索">
                    <a href="javascript:" class="weui-icon-clear"></a>
                </div>
                <label class="weui-search-bar__label">
                    <i class="weui-icon-search"></i>
                    <span>搜索</span> </label>
            </form>
            <a href="javascript:" class="weui-search-bar__cancel-btn">取消</a>
        </div>
        <div class="weui-cells searchbar-result">
        </div>
    </div>
    <div id="page2" class="page">
        <form id="form">
          <div class="weui-cells__title">商户参数</div>
            <div class="weui-cells weui-cells_form">
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">商户参数ID</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="mchnt_param_id" required=""  placeholder="请输入商户参数ID"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">业务类型</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="busi_type" required=""  placeholder="请输入业务类型"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">商户号</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="mchnt_cd"   placeholder="请输入商户号"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">收单机构</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="acq_inst_id"   placeholder="请输入收单机构"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">账户类型</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_type"   placeholder="请输入账户类型"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">开户名称</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_name"   placeholder="请输入开户名称"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">开户银行</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_bank"   placeholder="请输入开户银行"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">开户银行省</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_province"   placeholder="请输入开户银行省"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">开户银行市</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_city"   placeholder="请输入开户银行市"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">开户支行</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_bank_id"   placeholder="请输入开户支行"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">银行账号</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="account_no"   placeholder="请输入银行账号"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">信用卡开关</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="credit_flag" required=""  placeholder="请输入信用卡开关"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">信用卡单笔限额</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="credit_card_limit"   placeholder="请输入信用卡单笔限额"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">信用卡日限额</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="credit_date_limit"   placeholder="请输入信用卡日限额"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">借记卡单笔限额</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="debit_card_limit"   placeholder="请输入借记卡单笔限额"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">借记卡日限额</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="debit_date_limit"   placeholder="请输入借记卡日限额"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">MCC</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="mcc"   placeholder="请输入MCC"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">MCC18</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="mcc18"   placeholder="请输入MCC18"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">借记卡手续费</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="debit_card_fee"   placeholder="请输入借记卡手续费"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">贷记卡手续费</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="credit_card_fee"   placeholder="请输入贷记卡手续费"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">参数状态</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="status"   placeholder="请输入参数状态"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">拓展方</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="expand_inst_id" required=""  placeholder="请输入拓展方"> </div>
                </div>
                
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">拓展人</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" name="expand_id"   placeholder="请输入拓展人"> </div>
                </div>
                 
            </div>
            <div class="weui-btn-area btn-area">
                <a id="back-btn" href="javascript:" class="weui-btn weui-btn_default" onclick="weui.page.back()">返回</a>
                <a id="submit-btn" href="javascript:" class="weui-btn weui-btn_primary">提交</a>
            </div>
        </form>
    </div>
    <div id="page3" class="page">
        <div class="weui-form-preview">
                <div class="weui-form-preview__hd">
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">商户参数</label>
                    </div>
                </div>
                <div class="weui-form-preview__bd">
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">商户参数ID</label>
                        <span class="weui-form-preview__value" id="preview.mchnt_param_id"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">业务类型</label>
                        <span class="weui-form-preview__value" id="preview.busi_type"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">商户号</label>
                        <span class="weui-form-preview__value" id="preview.mchnt_cd"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">收单机构</label>
                        <span class="weui-form-preview__value" id="preview.acq_inst_id"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">账户类型</label>
                        <span class="weui-form-preview__value" id="preview.account_type"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">开户名称</label>
                        <span class="weui-form-preview__value" id="preview.account_name"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">开户银行</label>
                        <span class="weui-form-preview__value" id="preview.account_bank"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">开户银行省</label>
                        <span class="weui-form-preview__value" id="preview.account_province"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">开户银行市</label>
                        <span class="weui-form-preview__value" id="preview.account_city"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">开户支行</label>
                        <span class="weui-form-preview__value" id="preview.account_bank_id"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">银行账号</label>
                        <span class="weui-form-preview__value" id="preview.account_no"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">信用卡开关</label>
                        <span class="weui-form-preview__value" id="preview.credit_flag"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">信用卡单笔限额</label>
                        <span class="weui-form-preview__value" id="preview.credit_card_limit"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">信用卡日限额</label>
                        <span class="weui-form-preview__value" id="preview.credit_date_limit"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">借记卡单笔限额</label>
                        <span class="weui-form-preview__value" id="preview.debit_card_limit"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">借记卡日限额</label>
                        <span class="weui-form-preview__value" id="preview.debit_date_limit"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">MCC</label>
                        <span class="weui-form-preview__value" id="preview.mcc"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">MCC18</label>
                        <span class="weui-form-preview__value" id="preview.mcc18"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">借记卡手续费</label>
                        <span class="weui-form-preview__value" id="preview.debit_card_fee"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">贷记卡手续费</label>
                        <span class="weui-form-preview__value" id="preview.credit_card_fee"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">参数状态</label>
                        <span class="weui-form-preview__value" id="preview.status"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">拓展方</label>
                        <span class="weui-form-preview__value" id="preview.expand_inst_id"></span>
                    </div>
                    
                    <div class="weui-form-preview__item">
                        <label class="weui-form-preview__label">拓展人</label>
                        <span class="weui-form-preview__value" id="preview.expand_id"></span>
                    </div>
                    
                </div>
            </div>
    </div>
    <script type="text/javascript" src="../js/lib/zepto.js"></script>
    <script type="text/javascript" src="../js/lib/weuijs/weuijs.js"></script>
    <script id="result-template" type="text/html">
        {{each rows as row}}
        <div class="weui-cell weui-cell_access searchbar-result__item">
            <div class="weui-cell__bd weui-cell_primary">
                <p>
                    {{row.text}}
                </p>
            </div>
            <div class="weui-cell__ft">
            </div>
        </div>
        {{/each}}
    </script>
    <script>
    var operateType;
    var searchPage = weui.searchPage('#page1', {
        resultTpl: '#result-template',
        loader: onSearch,
        onChange: function() {
            console.log(this, arguments);
        },
        onSelect: function(row) {
            console.log(this, arguments);
            // weui.page.back();
            showActions(row);
        }
    });

    function onSearch(param, success, error) {
        $$.request('/action/bm/mchnt-param/search', param, {
            success: function(data) {
                success(data.rows);
            },
            error: function() {
                error();
            }
        });
    }

    function onView(param) {
        $$.request('/action/bm/mchnt-param/view', param, {
            success: function(data) {
                if (data.errcode == 0) {
                    weui.form.load('#form', data.data);
                } else {
                    weui.alert(data.errmsg, { title: '错误提示' });
                }
            },
            error: function() {}
        });
    }

    function onDelete(param) {
        $$.request('/action/bm/mchnt-param/delete', param, {
            success: function(data) {
                if (data.errcode == 0) {
                    weui.toast('操作成功');
                } else {
                    weui.alert(data.errmsg, { title: '错误提示' });
                }
            },
            error: function() {}
        });
    }

    function showActions(row) {
        weui.actionSheet([{
            label: '查看',
            onClick: function() {
                console.log(this, arguments);
                onView(row);
                weui.page.show('#page2');
                $('#back-btn').show().siblings().hide();
            }
        }, {
            label: '编辑',
            onClick: function() {
                console.log(this, arguments);
                onView(row);
                operateType = 'update';
                weui.page.show('#page2');
                $('#back-btn').show().siblings().show();
            }
        }, {
            label: '删除',
            onClick: function() {
                console.log(this, arguments);
                weui.confirm('确认要删除?', function() {
                    onDelete(row);
                });
            }
        }], [{
            label: '取消',
            onClick: function() {
                console.log(this, arguments);
            }
        }]);
    }

    var options = {
        callback: function(error) {
            console.log(this, arguments);
        },
        rules: {
            idnum: function(value, args) {
                return /(?:^\d{15}$)|(?:^\d{18}$)|^\d{17}[\dXx]$/.test(value);
            }
        }
    };

    // 失去焦点时检测
    weui.form.checkIfBlur('#form', options);

    function onSubmit() {
        if (!weui.form.validate('#form', options)) return;
        var param = $('#form').serializeObject();

        $$.request('/action/bm/mchnt-param/' + operateType, param, {
            success: function(data) {
                if (data.errcode == 0) {
                    weui.toast('操作成功');
                } else {
                    weui.alert(data.errmsg, { title: '错误提示' });
                }
            },
            error: function() {}
        });
    }

    function onClickAdd() {
        operateType = 'create';
        weui.page.show('#page2');
    }

    $(function() {
        $('#add-btn').on('click', onClickAdd);
        $('#submit-btn').on('click', onSubmit) ;
    });
    </script>
</body>

</html>