<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>结算信息</title>
    <link rel="stylesheet" href="../js/lib/weuijs/style/weuijs.min.css">
    <link rel="stylesheet" href="../css/ui-base.css">
</head>

<body>
    <form id="form">
        <!-- 填写结算信息开始 -->
        <div class="weui-cells__title">结算账户</div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell weui-cell_select weui-cell_select-after">
                <div class="weui-cell__hd">
                    <label for="" class="weui-label">账户类型<span class="required">*</span></label>
                </div>
                <div class="weui-cell__bd">
                    <select class="weui-select for_busi" name="account_type" id="account_type" value="1">
                        <option value="1">对公账户</option>
                        <option value="2">对私账户</option>
                    </select>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <div class="weui-uploader">
                        <div class="weui-uploader__hd">
                            <p class="weui-uploader__title">账户正面照片<span class="required">*</span></p>
                        </div>
                        <div class="weui-uploader__bd">
                            <ul class="weui-uploader__files" id="16">
                                <!-- <li class="weui-uploader__file" style="background-image:url(./images/pic_160.png)"></li>
                            <li class="weui-uploader__file" style="background-image:url(./images/pic_160.png)"></li>-->
                            </ul>
                            <div class="weui-uploader__input-box">
                                <input class="weui-uploader__input" type="file" accept="image/*" capture="camera">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="weui-label">账户户名<span class="required">*</span></label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input for_busi" name="account_name" required="" type="text" placeholder="请输入账户户名">
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label class="weui-label">银行账号<span class="required">*</span></label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input for_busi" name="account_no" required="" type="number" placeholder="请输入银行账号">
                </div>
            </div>
            <!--div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label for="" class="weui-label">开户银行</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" placeholder="请选择开户银行">
                    </div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label for="" class="weui-label">开户银行城市</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" placeholder="请选择开户银行城市">
                    </div>
                </div-->
            <div class="weui-cell">
                <div class="weui-cell__hd">
                    <label for="" class="weui-label">开户支行<span class="required">*</span></label>
                </div>
                <div class="weui-cell__bd">
                    <input class="weui-input" type="text" required="" name="subbranch_name" id="subbranch_name" placeholder="请选择开户支行" readonly>
                    <input class="for_busi" type="hidden" name="account_bank_branch_cd">
                </div>
            </div>
        </div>
        <!-- 填写结算信息结束 -->
        <div class="weui-btn-area btn-area">
            <a id="back-btn" href="javascript:" class="weui-btn weui-btn_default" onclick="weui.page.back()">返回</a>
            <a id="submit-btn" href="javascript:" class="weui-btn weui-btn_primary">提交</a>
        </div>
    </form>
    <!-- <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=mUs8UNiHRImGLNueae1Gd9PVdejrYdHC"></script> -->
    <script type="text/javascript" src="../js/lib/zepto.min.js"></script>
    <script type="text/javascript" src="../js/lib/weuijs/weuijs.min.js"></script>
    <script>
    var query = $$.parseQueryString();
    var operateType = query.operateType;

	var uploaderData = [];

    function initUploader(selector, options) {
		options = options ||{};
		options = $.extend({
			url: $$.wrapUrl('/action/upload'),
			auto: true,
            type: 'file',
            fileVal: 'file',
            compress: {
                width: 1600,
                height: 1600,
                quality: 0.92
            },
			onBeforeSend: function(data, headers) {
				console.log(this, arguments);
				if(["image/jpg", "image/jpeg", "image/png", "image/gif"].indexOf(this.type) < 0){
					weui.alert('请上传图片');
					return false; // 阻止文件添加
				}
				if(this.size > max_size * 1024 * 1024){
					weui.alert('请上传不超过10M的图片');
					return false;
				}
				// return false; // 阻止文件上传
			},
			onSuccess: function (ret) {
		        console.log(this, ret);;
		    },
		    onError: function(err){
		        console.log(this, err);
		    }
		}, options);
		return weui.ajaxUploader(selector, options);
    }
	
	$('.weui-uploader').each(function(i, element) {
		initUploader(this, {
			onSuccess: function (ret) {
		        console.log(ret);
				var elec_info_type = $(this).find('.weui-uploader__files').attr('id');
				uploaderData.push({status:'1', serverid:ret.serverid, elec_info_type: elec_info_type});
		    },
		});
	});

    function onSubmit() {
        if (!weui.form.validate('#form', $$.rules)) return;
        var param = $('#form').serializeObject();
		$.extend(param, {elec_info: uploaderData}, query);
		$$.request('/action/bm/mchnt-busi-temp/update', param, {
			success: function(data) {
				if (data.errcode == 0) {
					var flow = flows.busi(query.busi_type, query.acq_inst_id);
					flow.next();
				} else {
					weui.alert(data.errmsg, error, {
						title: '提示'
					});
				}
			},
			error: function() {
				error();
			}
		});
        // TODO ajax
    }

    $(function() {
        $('#submit-btn').on('click', onSubmit);
    });
    </script>
</body>

</html>
